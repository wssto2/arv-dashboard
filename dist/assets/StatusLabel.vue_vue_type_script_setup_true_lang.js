var N=Object.defineProperty;var q=(m,e,t)=>e in m?N(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var u=(m,e,t)=>q(m,typeof e!="symbol"?e+"":e,t);import{d as R,j as w,r as d,J as z,o as i,c as r,e as s,m as L,q as P,B as k,t as p,w as D,F,i as x,b as J,G as H,f as b,h as G,g as O,z as I,n as M,I as U,k as X,X as Q,R as W,S as Y}from"./vendor.js";import{_ as Z,u as ee}from"./useFetch.js";import{c as j,d as te,j as se}from"./index.js";const le={class:"collection-filter"},ae={class:"mr-5"},ie={key:1,class:"badge ml-5 mr-5"},oe={key:0},ne={key:1,class:"divider"},re=["onClick"],ce=R({__name:"CollectionFilter",props:{filter:{},selectedFilters:{}},emits:["updateFilter"],setup(m,{emit:e}){const t=m,h=e,a=w(()=>t.selectedFilters[t.filter.key]),o=w(()=>{var _;return a.value?(_=t.filter.options)==null?void 0:_.find(S=>S.value===a.value):null}),v=w(()=>a.value?Array.isArray(a.value)?a.value.length:1:0),f=w(()=>v.value>1),g=d(!1);function C(){g.value=!g.value}function V(_){if(!_||!_.target)return;_.target.closest(".collection-filter")||(g.value=!1)}function A(){h("updateFilter",t.filter.key,null)}function K(_){h("updateFilter",t.filter.key,_.value)}return window.addEventListener("click",V),z(()=>{window.removeEventListener("click",V)}),(_,S)=>(i(),r("div",le,[s("div",{class:P(["btn btn-default btn-rounded"]),onClick:D(C,["prevent"])},[t.filter.icon?(i(),L(j,{key:0,icon:t.filter.icon,class:P(["position-left",a.value?"text-primary":"text-grey"])},null,8,["icon","class"])):k("",!0),s("span",ae,p(o.value?o.value.label:t.filter.label),1),f.value?(i(),r("span",ie,p(v.value),1)):k("",!0),S[0]||(S[0]=s("span",{class:"caret"},null,-1))]),s("ul",{class:P(["dropdown-menu",{show:g.value}])},[t.filter.withoutDefaultOption?k("",!0):(i(),r("li",oe,[s("a",{href:"#",onClick:D(A,["prevent"])},p(t.filter.defaultOptionTitle?t.filter.defaultOptionTitle:"Prikaži sve"),1)])),t.filter.withoutDefaultOption?k("",!0):(i(),r("li",ne)),(i(!0),r(F,null,x(t.filter.options,$=>(i(),r("li",{key:$.value,class:P({active:a.value===$.value})},[s("a",{href:"#",onClick:D(T=>K($),["prevent"])},p($.label),9,re)],2))),128))],2)]))}}),ue={class:"collection-toolbar mb-10",style:{"user-select":"none"}},de={class:"btn-tab-group collection-views mb-20"},he=["onClick"],ve={class:"badge"},fe={class:"collection-filter-toolbar"},pe={class:"collection-search mr-10"},me={class:"collection-filters"},ge={class:"table table-hover dataTable"},ye={style:{"user-select":"none"}},_e=["onClick"],be={key:0,style:{width:"100px"}},ke={key:0},we={key:0},Pe={key:2},Ce=["colspan"],Se={class:"collection-footer",style:{"user-select":"none"}},$e={class:"collection-meta"},Fe=["value"],xe={class:"collection-pagination"},De=["disabled"],Ve=["disabled"],Je=R({__name:"CollectionTable",props:{collection:{},withActions:{type:Boolean,default:!1},rowHeight:{default:40}},setup(m){const e=m,t=e.collection.columns,h=e.collection.isFetching,a=e.collection.perPage,o=e.collection.views,v=e.collection.activeView,f=e.collection.orderColumnKey,g=e.collection.orderDirection,C=w(()=>{const l=a.value-1,y=e.rowHeight||40;return a.value*y+45+l+"px"});function V(n,l){let y=[];return l.hideOnMobile&&y.push("hidden-xs"),l.orderable?f.value!==n?(y.push("sorting"),y):(g.value==="asc"?y.push("sorting_asc"):y.push("sorting_desc"),y):y}function A(n){const l={};return n.width&&(l.width=`${n.width}px`),n.align&&(l.textAlign=n.align),l}function K(n){e.collection.setView(n).fromPage(1).fetch()}function _(n){if(t.value[n].orderable){if(f.value===n){e.collection.orderBy(n,g.value==="asc"?"desc":"asc").fetch();return}e.collection.orderBy(n,"asc").fetch()}}function S(n,l){e.collection.setFilter(n,l).fromPage(1).fetch()}const $=te(n=>{const l=n.target;e.collection.searchBy(l.value).fromPage(1).fetch()},300);function T(n){if(n.key==="f"&&(n.ctrlKey||n.metaKey)){n.preventDefault();const l=document.querySelector(".collection-search input");l&&l.focus()}}function E(n){if(n.key==="Tab"){n.preventDefault();const l=document.querySelector(".collection table tbody tr:first-child a");l&&l.focus()}}return J(()=>{document.addEventListener("keydown",T)}),z(()=>{document.removeEventListener("keydown",T)}),(n,l)=>{const y=H("icon");return i(),r("div",{class:"collection",style:M(`--row-height: ${e.rowHeight||40}px`)},[s("div",ue,[s("div",de,[(i(!0),r(F,null,x(b(o),c=>(i(),r("button",{key:c.key,class:P(["btn-tab",{active:c.key===b(v)}]),onClick:D(B=>K(c.key),["prevent"])},[G(p(c.label)+" ",1),s("span",ve,p(c.count),1)],10,he))),128))]),s("div",fe,[s("div",pe,[O(y,{icon:"search",width:"16"}),s("input",{type:"text",class:"form-control",placeholder:"Upišite za pretragu...",onInput:l[0]||(l[0]=(...c)=>b($)&&b($)(...c)),onKeydown:E},null,32),l[5]||(l[5]=s("span",{class:"keyboard-shortcut"},[s("i",null,"CTRL"),s("i",null,"F")],-1))]),s("div",me,[(i(!0),r(F,null,x(e.collection.filters.value,c=>(i(),L(ce,{filter:c,"selected-filters":e.collection.selectedFilters.value,class:"mr-10",onUpdateFilter:S},null,8,["filter","selected-filters"]))),256))])])]),O(Z,{"without-padding":!0,class:"mb-10"},{default:I(()=>[s("div",{class:"table-responsive",style:M({minHeight:C.value})},[s("table",ge,[s("thead",ye,[s("tr",null,[(i(!0),r(F,null,x(b(t),(c,B)=>(i(),r("th",{key:B,class:P(V(B,c)),style:M(A(c)),onClick:He=>_(B)},p(c.label),15,_e))),128)),e.withActions?(i(),r("th",be)):k("",!0)])]),b(h)?(i(),r("tbody",ke,[(i(!0),r(F,null,x(b(a),c=>(i(),r("tr",{key:`skeleton-${c}`},[(i(!0),r(F,null,x(b(t),B=>(i(),r("td",{key:B.label},l[6]||(l[6]=[s("div",{class:"skeleton"},null,-1)])))),128)),e.withActions?(i(),r("td",we,l[7]||(l[7]=[s("div",{class:"skeleton"},null,-1)]))):k("",!0)]))),128))])):k("",!0),!b(h)&&e.collection.total.value>0?U(n.$slots,"default",{key:1}):k("",!0),!b(h)&&e.collection.total.value===0?(i(),r("tbody",Pe,[s("tr",null,[s("td",{colspan:Object.entries(b(t)).length+(e.withActions?1:0),class:"text-center"},l[8]||(l[8]=[s("div",{class:"py-8"},[s("i",{class:"icon-strategy display-block icon-2x mb-20 text-grey"}),s("h6",{class:"text-bold display-block mb-10"},"Nema podataka"),s("span",{class:"text-semibold display-block"},"Prema traženom upitu nisu pronađeni podaci.")],-1)]),8,Ce)])])):k("",!0)])],4)]),_:3}),s("div",Se,[s("div",$e,[s("span",null,"Showing "+p(e.collection.from)+" to "+p(e.collection.to)+" of "+p(e.collection.total)+" entries",1),l[9]||(l[9]=s("span",{class:"vertical-divider"},null,-1)),l[10]||(l[10]=s("span",{class:"mr-10"},"Rows per page",-1)),X(s("select",{"onUpdate:modelValue":l[1]||(l[1]=c=>e.collection.perPage.value=c),onChange:l[2]||(l[2]=c=>e.collection.fetch())},[(i(),r(F,null,x([10,25,50,100],c=>s("option",{key:c,value:c},p(c),9,Fe)),64))],544),[[Q,e.collection.perPage.value]])]),s("div",xe,[s("p",null,[s("button",{class:"btn btn-default mr-5",disabled:e.collection.currentPage.value===1,onClick:l[3]||(l[3]=D(c=>e.collection.prevPage().fetch(),["prevent"]))},[O(y,{icon:"chevronLeft"})],8,De),s("button",{class:"btn btn-default",disabled:e.collection.currentPage.value>=e.collection.lastPage.value,onClick:l[4]||(l[4]=D(c=>e.collection.nextPage().fetch(),["prevent"]))},[O(y,{icon:"chevronRight"})],8,Ve)])])])],4)}}}),Be={key:0,class:"media-left media-middle"},Le={key:1},Oe={class:"media-body media-middle"},Re={class:"media-heading no-margin text-semibold"},Ae={class:"text-default"},Ke={key:0,class:"media-left media-middle"},Te={key:1},Me={class:"media-body media-middle"},Ue={class:"media-heading no-margin text-semibold"},je={class:"text-default"},Ge=R({__name:"RowTarget",props:{route:{},title:{},description:{default:null},icon:{},accent:{},withDecoration:{type:Boolean,default:!1},decorationSize:{default:"xs"}},emits:["click"],setup(m,{emit:e}){const t=m,h=w(()=>t.accent?[`alpha-${t.accent}`,`text-${t.accent}-800`]:["alpha-primary","text-primary-800"]),a=w(()=>t.title[0]),o=e;return(v,f)=>{const g=H("router-link");return v.route?(i(),L(g,{key:0,to:v.route,class:"media display-block row-target",tabindex:"0"},{default:I(()=>[t.icon||t.withDecoration?(i(),r("div",Be,[s("span",{class:P(["icon-decoration",t.decorationSize,...h.value])},[t.icon?(i(),L(j,{key:0,icon:t.icon},null,8,["icon"])):(i(),r("i",Le,p(a.value),1))],2)])):k("",!0),s("div",Oe,[s("p",Re,p(t.title),1),s("small",Ae,p(t.description),1),U(v.$slots,"default")])]),_:3},8,["to"])):(i(),r("a",{key:1,href:"#",onClick:f[0]||(f[0]=D(C=>o("click"),["prevent"])),class:"media display-block row-target",tabindex:"0"},[t.icon||t.withDecoration?(i(),r("div",Ke,[s("span",{class:P(["icon-decoration",t.decorationSize,...h.value])},[t.icon?(i(),L(j,{key:0,icon:t.icon},null,8,["icon"])):(i(),r("i",Te,p(a.value),1))],2)])):k("",!0),s("div",Me,[s("p",Ue,p(t.title),1),s("small",je,p(t.description),1),U(v.$slots,"default")])]))}}});class ze{constructor(){u(this,"columns",d({}));u(this,"views",d([]));u(this,"meta",d({}));u(this,"filters",d([]));u(this,"url",d(""));u(this,"data",d([]));u(this,"isFetching",d(!1));u(this,"isFailed",d(!1));u(this,"total",d(0));u(this,"currentPage",d(1));u(this,"from",d(0));u(this,"to",d(0));u(this,"lastPage",d(0));u(this,"perPage",d(10));u(this,"orderColumn",d(""));u(this,"orderDirection",d(""));u(this,"orderColumnKey",d(""));u(this,"search",d(""));u(this,"selectedFilters",d({}));u(this,"activeView",d(""));u(this,"shouldRememberState",d(!1));u(this,"rememberStateKey",d(""))}withURL(e){return this.url.value=e,this}withColumns(e){this.columns.value=e;const t=Object.keys(e);return this.orderColumn.value=t[0],this.orderDirection.value="asc",this}withViews(e){return this.views.value=e,e.length>0&&(this.activeView.value=e[0].key),this}setView(e){return this.views.value.find(t=>t.key===e)?(this.activeView.value=e,this):(console.warn(`View with key ${e} does not exist`),this)}searchBy(e){return this.search.value=e,this}orderBy(e,t){const h=this.columns.value[e];return h?h.orderable?(this.orderColumnKey.value=e,h.orderBy?this.orderColumn.value=h.orderBy:this.orderColumn.value=e,this.orderDirection.value=t||"asc",this):this:(console.warn(`Column with key ${e} does not exist`),this)}withFilters(e){return this.filters.value=e,this}setFilter(e,t){return this.selectedFilters.value={...this.selectedFilters.value,[e]:t},this}getFilter(e){return this.selectedFilters.value[e]}resetFilters(){return this.selectedFilters.value={},this}fromPage(e){return this.currentPage.value=e,this}prevPage(){return this.currentPage.value=Math.max(this.currentPage.value-1,1),this}nextPage(){return this.currentPage.value=Math.min(this.currentPage.value+1,this.lastPage.value),this}take(e){return this.perPage.value=e,this}items(){return this.data.value}rememberState(e){return this.shouldRememberState.value=!0,this.rememberStateKey.value=e,this}loadState(){const e=this.rememberStateKey.value;if(!e||e.length===0)return;const t=localStorage.getItem(`${e}_collection_state`);if(!t)return;const{currentPage:h,perPage:a,orderColumn:o,orderDirection:v,search:f,filters:g}=JSON.parse(t);this.currentPage.value=h,this.perPage.value=a,this.orderColumn.value=o,this.orderDirection.value=v,this.search.value=f,this.filters.value=g}saveState(){const e=this.rememberStateKey.value;if(!e||e.length===0)return;const t={currentPage:this.currentPage.value,perPage:this.perPage.value,orderColumn:this.orderColumn.value,orderDirection:this.orderDirection.value,search:this.search.value,filters:this.filters.value};localStorage.setItem(`${e}_collection_state`,JSON.stringify(t))}async fetch(){var h;this.shouldRememberState.value&&this.loadState(),this.isFailed.value=!1,this.isFetching.value=!0;let e=this.url.value;/^(http|https):\/\//.test(e)||(e=se(((h=window==null?void 0:window.DASHBOARD_STATE)==null?void 0:h.api_base_url)||"",this.url.value));const t=new URL(e);!t.searchParams.has("page")&&this.currentPage.value>0&&t.searchParams.append("page",this.currentPage.value.toString()),!t.searchParams.has("per_page")&&this.perPage.value>0&&t.searchParams.append("length",this.perPage.value.toString()),t.searchParams.has("order_column")||t.searchParams.append("order_column",this.orderColumn.value),t.searchParams.has("order_direction")||t.searchParams.append("order_direction",this.orderDirection.value),!t.searchParams.has("search")&&this.search.value.length>0&&t.searchParams.append("search",this.search.value),!t.searchParams.has("view")&&this.activeView.value.length>0&&t.searchParams.append("view",this.activeView.value);for(const[a,o]of Object.entries(this.selectedFilters.value))o==null||o===""||t.searchParams.append(a,o);try{const{data:a}=await ee(t.toString()).get().json();if(this.data.value=a.value.data||[],this.total.value=a.value.total||0,this.currentPage.value=a.value.current_page||0,this.from.value=a.value.from||0,this.to.value=a.value.to||0,this.lastPage.value=a.value.last_page||0,this.perPage.value=a.value.per_page||0,a.value.views)for(const o of a.value.views){const v=this.views.value.find(f=>f.key===o.key);v&&(v.count=o.count)}a.value.meta&&(this.meta.value=a.value.meta),this.shouldRememberState.value&&this.saveState()}catch(a){console.error(a),this.isFailed.value=!0}this.isFetching.value=!1}}function Xe(){return new ze}const Qe=R({__name:"StatusLabel",props:W({states:{default:()=>[{value:"0",label:"Neaktivno",accent:"warning"},{value:"1",label:"Aktivno",accent:"success"}]}},{modelValue:{type:[String,Number,Boolean]},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const e=m,t=Y(m,"modelValue"),h=w(()=>{var f;let o=(f=t.value)==null?void 0:f.toString();o==="true"?o="1":o==="false"&&(o="0");const v=e.states.find(g=>g.value.toString()===o);return v?v.label:"Unknown"}),a=w(()=>{var C;let o=(C=t.value)==null?void 0:C.toString();o==="true"?o="1":o==="false"&&(o="0");const v=e.states.find(V=>V.value.toString()===o),f=v?v.accent:"default";return["default","primary","success","info","warning","danger"].includes(f)?`label-${f}`:`bg-${f}`});return(o,v)=>(i(),r("span",{class:P(["label",a.value])},p(h.value),3))}});export{Ge as _,Qe as a,Je as b,Xe as u};
